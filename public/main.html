
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>부동산 데이터 수집기</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- 인증 확인 스크립트 -->
    <script>
        (function() {
            // 인증 상태 확인
            const authData = localStorage.getItem('real_estate_auth');
            
            if (!authData) {
                // 인증 정보 없음
                alert('접근 권한이 없습니다. 로그인 페이지로 이동합니다.');
                window.location.href = 'index.html';
                return;
            }

            try {
                const auth = JSON.parse(atob(authData));
                const currentTime = Date.now();
                const sessionDuration = 24 * 60 * 60 * 1000; // 24시간

                // 세션 만료 확인
                if (currentTime - auth.timestamp > sessionDuration) {
                    localStorage.removeItem('real_estate_auth');
                    alert('세션이 만료되었습니다. 다시 로그인해주세요.');
                    window.location.href = 'index.html';
                    return;
                }

                // 시리얼 번호 재검증 (간단한 형태)
                if (!auth.serial || !auth.serial.includes('-') || auth.serial.length < 10) {
                    localStorage.removeItem('real_estate_auth');
                    alert('잘못된 인증 정보입니다.');
                    window.location.href = 'index.html';
                    return;
                }

                // 인증 성공 - 사용자 정보 표시
                console.log('인증된 사용자:', auth.productCode, '|', '세션 유효시간:', Math.round((sessionDuration - (currentTime - auth.timestamp)) / (60 * 60 * 1000)) + '시간');
                
            } catch (e) {
                // 인증 데이터 손상
                localStorage.removeItem('real_estate_auth');
                alert('인증 정보가 손상되었습니다.');
                window.location.href = 'index.html';
                return;
            }
        })();
    </script>
    <div class="container">
        <header>
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                <div></div>
                <div style="display: flex; gap: 10px; font-size: 0.9rem; color: var(--secondary-text);">
                    <span id="userInfo">인증된 사용자</span>
                    <button onclick="logout()" style="background: #dc3545; color: white; border: none; padding: 5px 12px; border-radius: 4px; cursor: pointer; font-size: 0.8rem;">로그아웃</button>
                </div>
            </div>
            <h1>네이버 부동산 데이터 수집기</h1>
            <p>지역별 아파트 매물 정보를 수집하여 조회하고 엑셀로 저장합니다.</p>
        </header>

        <main>
            <div class="controls">
                <div class="control-group">
                    <label for="region-input">❁ 지역명 (예: 천호동)</label>
                    <div class="search-wrapper">
                        <input type="text" id="region-input" placeholder="지역명을 입력하세요...">
                        <button id="search-btn">지역 검색</button>
                    </div>
                </div>

                <div class="control-group">
                    <label for="complex-dropdown">❁ 아파트 단지 선택</label>
                    <select id="complex-dropdown" disabled>
                        <option value="">먼저 지역을 검색해주세요</option>
                    </select>
                </div>

                <div class="control-group">
                    <label for="trade-type-dropdown">❁ 거래 유형</label>
                    <select id="trade-type-dropdown">
                        <option value="전체">전체</option>
                        <option value="매매">매매</option>
                        <option value="전세">전세</option>
                        <option value="월세">월세</option>
                    </select>
                </div>

                <div class="action-buttons">
                    <button id="fetch-btn" disabled>데이터 수집 시작</button>
                    <button id="download-btn" disabled>엑셀로 저장</button>
                </div>
            </div>

            <div id="status-area">
                <p id="status-text">준비 완료</p>
            </div>

            <div class="results-container">
                <div id="table-container"></div>
            </div>
        </main>

        <footer>
            <p>Made By Deok ❁´◡`❁</p>
        </footer>
    </div>

    <script src="script.js"></script>
</body>
</html>
